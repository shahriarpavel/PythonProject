<html>
<head>
<title>style.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
style.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">lru_cache</span>
<span class="s0">from </span><span class="s1">marshal </span><span class="s0">import </span><span class="s1">dumps</span><span class="s2">, </span><span class="s1">loads</span>
<span class="s0">from </span><span class="s1">random </span><span class="s0">import </span><span class="s1">randint</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Any</span><span class="s2">, </span><span class="s1">Dict</span><span class="s2">, </span><span class="s1">Iterable</span><span class="s2">, </span><span class="s1">List</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">, </span><span class="s1">Type</span><span class="s2">, </span><span class="s1">Union</span><span class="s2">, </span><span class="s1">cast</span>

<span class="s0">from </span><span class="s2">. </span><span class="s0">import </span><span class="s1">errors</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">color </span><span class="s0">import </span><span class="s1">Color</span><span class="s2">, </span><span class="s1">ColorParseError</span><span class="s2">, </span><span class="s1">ColorSystem</span><span class="s2">, </span><span class="s1">blend_rgb</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">repr </span><span class="s0">import </span><span class="s1">Result</span><span class="s2">, </span><span class="s1">rich_repr</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">terminal_theme </span><span class="s0">import </span><span class="s1">DEFAULT_TERMINAL_THEME</span><span class="s2">, </span><span class="s1">TerminalTheme</span>

<span class="s3"># Style instances and style definitions are often interchangeable</span>
<span class="s1">StyleType </span><span class="s2">= </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s4">&quot;Style&quot;</span><span class="s2">]</span>


<span class="s0">class </span><span class="s1">_Bit</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot;A descriptor to get/set a style attribute bit.&quot;&quot;&quot;</span>

    <span class="s1">__slots__ </span><span class="s2">= [</span><span class="s4">&quot;bit&quot;</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">bit_no</span><span class="s2">: </span><span class="s1">int</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">bit </span><span class="s2">= </span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s1">bit_no</span>

    <span class="s0">def </span><span class="s1">__get__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">: </span><span class="s4">&quot;Style&quot;</span><span class="s2">, </span><span class="s1">objtype</span><span class="s2">: </span><span class="s1">Type</span><span class="s2">[</span><span class="s4">&quot;Style&quot;</span><span class="s2">]) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">]:</span>
        <span class="s0">if </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bit</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bit </span><span class="s2">!= </span><span class="s6">0</span>
        <span class="s0">return None</span>


<span class="s2">@</span><span class="s1">rich_repr</span>
<span class="s0">class </span><span class="s1">Style</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot;A terminal style. 
 
    A terminal style consists of a color (`color`), a background color (`bgcolor`), and a number of attributes, such 
    as bold, italic etc. The attributes have 3 states: they can either be on 
    (``True``), off (``False``), or not set (``None``). 
 
    Args: 
        color (Union[Color, str], optional): Color of terminal text. Defaults to None. 
        bgcolor (Union[Color, str], optional): Color of terminal background. Defaults to None. 
        bold (bool, optional): Enable bold text. Defaults to None. 
        dim (bool, optional): Enable dim text. Defaults to None. 
        italic (bool, optional): Enable italic text. Defaults to None. 
        underline (bool, optional): Enable underlined text. Defaults to None. 
        blink (bool, optional): Enabled blinking text. Defaults to None. 
        blink2 (bool, optional): Enable fast blinking text. Defaults to None. 
        reverse (bool, optional): Enabled reverse text. Defaults to None. 
        conceal (bool, optional): Enable concealed text. Defaults to None. 
        strike (bool, optional): Enable strikethrough text. Defaults to None. 
        underline2 (bool, optional): Enable doubly underlined text. Defaults to None. 
        frame (bool, optional): Enable framed text. Defaults to None. 
        encircle (bool, optional): Enable encircled text. Defaults to None. 
        overline (bool, optional): Enable overlined text. Defaults to None. 
        link (str, link): Link URL. Defaults to None. 
 
    &quot;&quot;&quot;</span>

    <span class="s1">_color</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">]</span>
    <span class="s1">_bgcolor</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">]</span>
    <span class="s1">_attributes</span><span class="s2">: </span><span class="s1">int</span>
    <span class="s1">_set_attributes</span><span class="s2">: </span><span class="s1">int</span>
    <span class="s1">_hash</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">]</span>
    <span class="s1">_null</span><span class="s2">: </span><span class="s1">bool</span>
    <span class="s1">_meta</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bytes</span><span class="s2">]</span>

    <span class="s1">__slots__ </span><span class="s2">= [</span>
        <span class="s4">&quot;_color&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_bgcolor&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_attributes&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_set_attributes&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_link&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_link_id&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_ansi&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_style_definition&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_hash&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_null&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;_meta&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>

    <span class="s3"># maps bits on to SGR parameter</span>
    <span class="s1">_style_map </span><span class="s2">= {</span>
        <span class="s6">0</span><span class="s2">: </span><span class="s4">&quot;1&quot;</span><span class="s2">,</span>
        <span class="s6">1</span><span class="s2">: </span><span class="s4">&quot;2&quot;</span><span class="s2">,</span>
        <span class="s6">2</span><span class="s2">: </span><span class="s4">&quot;3&quot;</span><span class="s2">,</span>
        <span class="s6">3</span><span class="s2">: </span><span class="s4">&quot;4&quot;</span><span class="s2">,</span>
        <span class="s6">4</span><span class="s2">: </span><span class="s4">&quot;5&quot;</span><span class="s2">,</span>
        <span class="s6">5</span><span class="s2">: </span><span class="s4">&quot;6&quot;</span><span class="s2">,</span>
        <span class="s6">6</span><span class="s2">: </span><span class="s4">&quot;7&quot;</span><span class="s2">,</span>
        <span class="s6">7</span><span class="s2">: </span><span class="s4">&quot;8&quot;</span><span class="s2">,</span>
        <span class="s6">8</span><span class="s2">: </span><span class="s4">&quot;9&quot;</span><span class="s2">,</span>
        <span class="s6">9</span><span class="s2">: </span><span class="s4">&quot;21&quot;</span><span class="s2">,</span>
        <span class="s6">10</span><span class="s2">: </span><span class="s4">&quot;51&quot;</span><span class="s2">,</span>
        <span class="s6">11</span><span class="s2">: </span><span class="s4">&quot;52&quot;</span><span class="s2">,</span>
        <span class="s6">12</span><span class="s2">: </span><span class="s4">&quot;53&quot;</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s1">STYLE_ATTRIBUTES </span><span class="s2">= {</span>
        <span class="s4">&quot;dim&quot;</span><span class="s2">: </span><span class="s4">&quot;dim&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s4">&quot;dim&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;bold&quot;</span><span class="s2">: </span><span class="s4">&quot;bold&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;b&quot;</span><span class="s2">: </span><span class="s4">&quot;bold&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;italic&quot;</span><span class="s2">: </span><span class="s4">&quot;italic&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;i&quot;</span><span class="s2">: </span><span class="s4">&quot;italic&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;underline&quot;</span><span class="s2">: </span><span class="s4">&quot;underline&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;u&quot;</span><span class="s2">: </span><span class="s4">&quot;underline&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;blink&quot;</span><span class="s2">: </span><span class="s4">&quot;blink&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;blink2&quot;</span><span class="s2">: </span><span class="s4">&quot;blink2&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;reverse&quot;</span><span class="s2">: </span><span class="s4">&quot;reverse&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;r&quot;</span><span class="s2">: </span><span class="s4">&quot;reverse&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;conceal&quot;</span><span class="s2">: </span><span class="s4">&quot;conceal&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;c&quot;</span><span class="s2">: </span><span class="s4">&quot;conceal&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;strike&quot;</span><span class="s2">: </span><span class="s4">&quot;strike&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;s&quot;</span><span class="s2">: </span><span class="s4">&quot;strike&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;underline2&quot;</span><span class="s2">: </span><span class="s4">&quot;underline2&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;uu&quot;</span><span class="s2">: </span><span class="s4">&quot;underline2&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;frame&quot;</span><span class="s2">: </span><span class="s4">&quot;frame&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;encircle&quot;</span><span class="s2">: </span><span class="s4">&quot;encircle&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;overline&quot;</span><span class="s2">: </span><span class="s4">&quot;overline&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;o&quot;</span><span class="s2">: </span><span class="s4">&quot;overline&quot;</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s2">*,</span>
        <span class="s1">color</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">bgcolor</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">bold</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">dim</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">italic</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">underline</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">blink</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">blink2</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">reverse</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">conceal</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">strike</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">underline2</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">frame</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">encircle</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">overline</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">link</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">meta</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>

        <span class="s0">def </span><span class="s1">_make_color</span><span class="s2">(</span><span class="s1">color</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]) </span><span class="s1">-&gt; Color</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">color </span><span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">color</span><span class="s2">, </span><span class="s1">Color</span><span class="s2">) </span><span class="s0">else </span><span class="s1">Color</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">color</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s0">None if </span><span class="s1">color </span><span class="s0">is None else </span><span class="s1">_make_color</span><span class="s2">(</span><span class="s1">color</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s0">None if </span><span class="s1">bgcolor </span><span class="s0">is None else </span><span class="s1">_make_color</span><span class="s2">(</span><span class="s1">bgcolor</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">sum</span><span class="s2">(</span>
            <span class="s2">(</span>
                <span class="s1">bold </span><span class="s0">is not None</span><span class="s2">,</span>
                <span class="s1">dim </span><span class="s0">is not None and </span><span class="s6">2</span><span class="s2">,</span>
                <span class="s1">italic </span><span class="s0">is not None and </span><span class="s6">4</span><span class="s2">,</span>
                <span class="s1">underline </span><span class="s0">is not None and </span><span class="s6">8</span><span class="s2">,</span>
                <span class="s1">blink </span><span class="s0">is not None and </span><span class="s6">16</span><span class="s2">,</span>
                <span class="s1">blink2 </span><span class="s0">is not None and </span><span class="s6">32</span><span class="s2">,</span>
                <span class="s1">reverse </span><span class="s0">is not None and </span><span class="s6">64</span><span class="s2">,</span>
                <span class="s1">conceal </span><span class="s0">is not None and </span><span class="s6">128</span><span class="s2">,</span>
                <span class="s1">strike </span><span class="s0">is not None and </span><span class="s6">256</span><span class="s2">,</span>
                <span class="s1">underline2 </span><span class="s0">is not None and </span><span class="s6">512</span><span class="s2">,</span>
                <span class="s1">frame </span><span class="s0">is not None and </span><span class="s6">1024</span><span class="s2">,</span>
                <span class="s1">encircle </span><span class="s0">is not None and </span><span class="s6">2048</span><span class="s2">,</span>
                <span class="s1">overline </span><span class="s0">is not None and </span><span class="s6">4096</span><span class="s2">,</span>
            <span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= (</span>
            <span class="s1">sum</span><span class="s2">(</span>
                <span class="s2">(</span>
                    <span class="s1">bold </span><span class="s0">and </span><span class="s6">1 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">dim </span><span class="s0">and </span><span class="s6">2 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">italic </span><span class="s0">and </span><span class="s6">4 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">underline </span><span class="s0">and </span><span class="s6">8 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">blink </span><span class="s0">and </span><span class="s6">16 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">blink2 </span><span class="s0">and </span><span class="s6">32 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">reverse </span><span class="s0">and </span><span class="s6">64 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">conceal </span><span class="s0">and </span><span class="s6">128 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">strike </span><span class="s0">and </span><span class="s6">256 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">underline2 </span><span class="s0">and </span><span class="s6">512 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">frame </span><span class="s0">and </span><span class="s6">1024 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">encircle </span><span class="s0">and </span><span class="s6">2048 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">overline </span><span class="s0">and </span><span class="s6">4096 </span><span class="s0">or </span><span class="s6">0</span><span class="s2">,</span>
                <span class="s2">)</span>
            <span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
            <span class="s0">else </span><span class="s6">0</span>
        <span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s1">link</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s0">None if </span><span class="s1">meta </span><span class="s0">is None else </span><span class="s1">dumps</span><span class="s2">(</span><span class="s1">meta</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= (</span>
            <span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">randint</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">999999</span><span class="s2">)</span><span class="s0">}{</span><span class="s1">hash</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s2">(</span><span class="s1">link </span><span class="s0">or </span><span class="s1">meta</span><span class="s2">) </span><span class="s0">else </span><span class="s4">&quot;&quot;</span>
        <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_hash</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">not </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s0">or </span><span class="s1">color </span><span class="s0">or </span><span class="s1">bgcolor </span><span class="s0">or </span><span class="s1">link </span><span class="s0">or </span><span class="s1">meta</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">null</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Create an 'null' style, equivalent to Style(), but more performant.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">NULL_STYLE</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">from_color</span><span class="s2">(</span>
        <span class="s1">cls</span><span class="s2">, </span><span class="s1">color</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">, </span><span class="s1">bgcolor</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Create a new style with colors and no attributes. 
 
        Returns: 
            color (Optional[Color]): A (foreground) color, or None for no color. Defaults to None. 
            bgcolor (Optional[Color]): A (background) color, or None for no color. Defaults to None. 
        &quot;&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">color</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s1">bgcolor</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">not </span><span class="s2">(</span><span class="s1">color </span><span class="s0">or </span><span class="s1">bgcolor</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">from_meta</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">meta</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]]) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Create a new style with meta data. 
 
        Returns: 
            meta (Optional[Dict[str, Any]]): A dictionary of meta data. Defaults to None. 
        &quot;&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s6">0</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s1">dumps</span><span class="s2">(</span><span class="s1">meta</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">randint</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">999999</span><span class="s2">)</span><span class="s0">}{</span><span class="s1">hash</span><span class="s2">(</span><span class="s1">style</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">not </span><span class="s2">(</span><span class="s1">meta</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">on</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">meta</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">, **</span><span class="s1">handlers</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Create a blank style with meta information. 
 
        Example: 
            style = Style.on(click=self.on_click) 
 
        Args: 
            meta (Optional[Dict[str, Any]], optional): An optional dict of meta information. 
            **handlers (Any): Keyword arguments are translated in to handlers. 
 
        Returns: 
            Style: A Style with meta information attached. 
        &quot;&quot;&quot;</span>
        <span class="s1">meta </span><span class="s2">= {} </span><span class="s0">if </span><span class="s1">meta </span><span class="s0">is None else </span><span class="s1">meta</span>
        <span class="s1">meta</span><span class="s2">.</span><span class="s1">update</span><span class="s2">({</span><span class="s4">f&quot;@</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">: </span><span class="s1">value </span><span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()})</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">from_meta</span><span class="s2">(</span><span class="s1">meta</span><span class="s2">)</span>

    <span class="s1">bold </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">dim </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">italic </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">underline </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">3</span><span class="s2">)</span>
    <span class="s1">blink </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">4</span><span class="s2">)</span>
    <span class="s1">blink2 </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>
    <span class="s1">reverse </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">6</span><span class="s2">)</span>
    <span class="s1">conceal </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">7</span><span class="s2">)</span>
    <span class="s1">strike </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">8</span><span class="s2">)</span>
    <span class="s1">underline2 </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">9</span><span class="s2">)</span>
    <span class="s1">frame </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">10</span><span class="s2">)</span>
    <span class="s1">encircle </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">11</span><span class="s2">)</span>
    <span class="s1">overline </span><span class="s2">= </span><span class="s1">_Bit</span><span class="s2">(</span><span class="s6">12</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">link_id</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a link id, used in ansi code for links.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link_id</span>

    <span class="s0">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Re-generate style definition from attributes.&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">attributes</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
            <span class="s1">append </span><span class="s2">= </span><span class="s1">attributes</span><span class="s2">.</span><span class="s1">append</span>
            <span class="s1">bits </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
            <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; </span><span class="s6">0b0000000001111</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; </span><span class="s6">1</span><span class="s2">:</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;bold&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bold </span><span class="s0">else </span><span class="s4">&quot;not bold&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">1</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;dim&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dim </span><span class="s0">else </span><span class="s4">&quot;not dim&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">2</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;italic&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">italic </span><span class="s0">else </span><span class="s4">&quot;not italic&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">3</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;underline&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">underline </span><span class="s0">else </span><span class="s4">&quot;not underline&quot;</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; </span><span class="s6">0b0000111110000</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">4</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;blink&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">blink </span><span class="s0">else </span><span class="s4">&quot;not blink&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">5</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;blink2&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">blink2 </span><span class="s0">else </span><span class="s4">&quot;not blink2&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">6</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;reverse&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">reverse </span><span class="s0">else </span><span class="s4">&quot;not reverse&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">7</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;conceal&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">conceal </span><span class="s0">else </span><span class="s4">&quot;not conceal&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">8</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;strike&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">strike </span><span class="s0">else </span><span class="s4">&quot;not strike&quot;</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; </span><span class="s6">0b1111000000000</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">9</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;underline2&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">underline2 </span><span class="s0">else </span><span class="s4">&quot;not underline2&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">10</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;frame&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">frame </span><span class="s0">else </span><span class="s4">&quot;not frame&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">11</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;encircle&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">encircle </span><span class="s0">else </span><span class="s4">&quot;not encircle&quot;</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">bits </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s6">12</span><span class="s2">):</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;overline&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overline </span><span class="s0">else </span><span class="s4">&quot;not overline&quot;</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;on&quot;</span><span class="s2">)</span>
                <span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span><span class="s2">:</span>
                <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;link&quot;</span><span class="s2">)</span>
                <span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s4">&quot; &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">attributes</span><span class="s2">) </span><span class="s0">or </span><span class="s4">&quot;none&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition</span>

    <span class="s0">def </span><span class="s1">__bool__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;A Style is false if it has no attributes, colors, or links.&quot;&quot;&quot;</span>
        <span class="s0">return not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_null</span>

    <span class="s0">def </span><span class="s1">_make_ansi_codes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">color_system</span><span class="s2">: </span><span class="s1">ColorSystem</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Generate ANSI codes for this style. 
 
        Args: 
            color_system (ColorSystem): Color system. 
 
        Returns: 
            str: String containing codes. 
        &quot;&quot;&quot;</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">sgr</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
            <span class="s1">append </span><span class="s2">= </span><span class="s1">sgr</span><span class="s2">.</span><span class="s1">append</span>
            <span class="s1">_style_map </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_map</span>
            <span class="s1">attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
            <span class="s0">if </span><span class="s1">attributes</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">1</span><span class="s2">:</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">2</span><span class="s2">:</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s6">1</span><span class="s2">])</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">4</span><span class="s2">:</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s6">2</span><span class="s2">])</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">8</span><span class="s2">:</span>
                    <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s6">3</span><span class="s2">])</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">0b0000111110000</span><span class="s2">:</span>
                    <span class="s0">for </span><span class="s1">bit </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">9</span><span class="s2">):</span>
                        <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s1">bit</span><span class="s2">):</span>
                            <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s1">bit</span><span class="s2">])</span>
                <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; </span><span class="s6">0b1111000000000</span><span class="s2">:</span>
                    <span class="s0">for </span><span class="s1">bit </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">9</span><span class="s2">, </span><span class="s6">13</span><span class="s2">):</span>
                        <span class="s0">if </span><span class="s1">attributes </span><span class="s2">&amp; (</span><span class="s6">1 </span><span class="s2">&lt;&lt; </span><span class="s1">bit</span><span class="s2">):</span>
                            <span class="s1">append</span><span class="s2">(</span><span class="s1">_style_map</span><span class="s2">[</span><span class="s1">bit</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">sgr</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span><span class="s2">.</span><span class="s1">downgrade</span><span class="s2">(</span><span class="s1">color_system</span><span class="s2">).</span><span class="s1">get_ansi_codes</span><span class="s2">())</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">sgr</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span><span class="s2">.</span><span class="s1">downgrade</span><span class="s2">(</span><span class="s1">color_system</span><span class="s2">).</span><span class="s1">get_ansi_codes</span><span class="s2">(</span>
                        <span class="s1">foreground</span><span class="s2">=</span><span class="s0">False</span>
                    <span class="s2">)</span>
                <span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s4">&quot;;&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">sgr</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s2">@</span><span class="s1">lru_cache</span><span class="s2">(</span><span class="s1">maxsize</span><span class="s2">=</span><span class="s6">1024</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">style</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Normalize a style definition so that styles with the same effect have the same string 
        representation. 
 
        Args: 
            style (str): A style definition. 
 
        Returns: 
            str: Normal form of style definition. 
        &quot;&quot;&quot;</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">style</span><span class="s2">))</span>
        <span class="s0">except </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">style</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">().</span><span class="s1">lower</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">pick_first</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, *</span><span class="s1">values</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">StyleType</span><span class="s2">]) </span><span class="s1">-&gt; StyleType</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Pick first non-None style.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">value </span><span class="s0">in </span><span class="s1">values</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">value </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">value</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">&quot;expected at least one non-None style&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rich_repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Result</span><span class="s2">:</span>
        <span class="s0">yield </span><span class="s4">&quot;color&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;bgcolor&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bgcolor</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;bold&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bold</span><span class="s2">, </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s0">yield </span><span class="s4">&quot;dim&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dim</span><span class="s2">, </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s0">yield </span><span class="s4">&quot;italic&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">italic</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;underline&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">underline</span><span class="s2">, </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s0">yield </span><span class="s4">&quot;blink&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">blink</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;blink2&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">blink2</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;reverse&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">reverse</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;conceal&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">conceal</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;strike&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">strike</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;underline2&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">underline2</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;frame&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">frame</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;encircle&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">encircle</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">yield </span><span class="s4">&quot;link&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">link</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s4">&quot;meta&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">meta</span>

    <span class="s0">def </span><span class="s1">__eq__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">Style</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">NotImplemented</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__hash__</span><span class="s2">() == </span><span class="s1">other</span><span class="s2">.</span><span class="s1">__hash__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__ne__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">Style</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">NotImplemented</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__hash__</span><span class="s2">() != </span><span class="s1">other</span><span class="s2">.</span><span class="s1">__hash__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__hash__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; int</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_hash </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_hash</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s1">hash</span><span class="s2">(</span>
            <span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span><span class="s2">,</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span><span class="s2">,</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes</span><span class="s2">,</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span><span class="s2">,</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span><span class="s2">,</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">,</span>
            <span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_hash</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">]:</span>
        <span class="s5">&quot;&quot;&quot;The foreground color or None if it is not set.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">bgcolor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Color</span><span class="s2">]:</span>
        <span class="s5">&quot;&quot;&quot;The background color or None if it is not set.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">link</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]:</span>
        <span class="s5">&quot;&quot;&quot;Link text, if set.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">transparent_background</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Check if the style specified a transparent background.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bgcolor </span><span class="s0">is None or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bgcolor</span><span class="s2">.</span><span class="s1">is_default</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">background_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;A Style with background only.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">Style</span><span class="s2">(</span><span class="s1">bgcolor</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">bgcolor</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">meta</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s5">&quot;&quot;&quot;Get meta information (can not be changed after construction).&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s2">{} </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta </span><span class="s0">is None else </span><span class="s1">cast</span><span class="s2">(</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">], </span><span class="s1">loads</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">without_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a copy of the style with color removed.&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_null</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">NULL_STYLE</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">randint</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">999999</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link </span><span class="s0">else </span><span class="s4">&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s2">@</span><span class="s1">lru_cache</span><span class="s2">(</span><span class="s1">maxsize</span><span class="s2">=</span><span class="s6">4096</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">parse</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">style_definition</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Parse a style definition. 
 
        Args: 
            style_definition (str): A string containing a style. 
 
        Raises: 
            errors.StyleSyntaxError: If the style definition syntax is invalid. 
 
        Returns: 
            `Style`: A Style instance. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">style_definition</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">() == </span><span class="s4">&quot;none&quot; </span><span class="s0">or not </span><span class="s1">style_definition</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">null</span><span class="s2">()</span>

        <span class="s1">STYLE_ATTRIBUTES </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">STYLE_ATTRIBUTES</span>
        <span class="s1">color</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s1">bgcolor</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s1">attributes</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Any</span><span class="s2">]] = {}</span>
        <span class="s1">link</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>

        <span class="s1">words </span><span class="s2">= </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">style_definition</span><span class="s2">.</span><span class="s1">split</span><span class="s2">())</span>
        <span class="s0">for </span><span class="s1">original_word </span><span class="s0">in </span><span class="s1">words</span><span class="s2">:</span>
            <span class="s1">word </span><span class="s2">= </span><span class="s1">original_word</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span>
            <span class="s0">if </span><span class="s1">word </span><span class="s2">== </span><span class="s4">&quot;on&quot;</span><span class="s2">:</span>
                <span class="s1">word </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">words</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
                <span class="s0">if not </span><span class="s1">word</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">(</span><span class="s4">&quot;color expected after 'on'&quot;</span><span class="s2">)</span>
                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s1">Color</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">word</span><span class="s2">)</span>
                <span class="s0">except </span><span class="s1">ColorParseError </span><span class="s0">as </span><span class="s1">error</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">(</span>
                        <span class="s4">f&quot;unable to parse </span><span class="s0">{</span><span class="s1">word</span><span class="s0">!r} </span><span class="s4">as background color; </span><span class="s0">{</span><span class="s1">error</span><span class="s0">}</span><span class="s4">&quot;</span>
                    <span class="s2">) </span><span class="s0">from None</span>
                <span class="s1">bgcolor </span><span class="s2">= </span><span class="s1">word</span>

            <span class="s0">elif </span><span class="s1">word </span><span class="s2">== </span><span class="s4">&quot;not&quot;</span><span class="s2">:</span>
                <span class="s1">word </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">words</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
                <span class="s1">attribute </span><span class="s2">= </span><span class="s1">STYLE_ATTRIBUTES</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">word</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">attribute </span><span class="s0">is None</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">(</span>
                        <span class="s4">f&quot;expected style attribute after 'not', found </span><span class="s0">{</span><span class="s1">word</span><span class="s0">!r}</span><span class="s4">&quot;</span>
                    <span class="s2">)</span>
                <span class="s1">attributes</span><span class="s2">[</span><span class="s1">attribute</span><span class="s2">] = </span><span class="s0">False</span>

            <span class="s0">elif </span><span class="s1">word </span><span class="s2">== </span><span class="s4">&quot;link&quot;</span><span class="s2">:</span>
                <span class="s1">word </span><span class="s2">= </span><span class="s1">next</span><span class="s2">(</span><span class="s1">words</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
                <span class="s0">if not </span><span class="s1">word</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">(</span><span class="s4">&quot;URL expected after 'link'&quot;</span><span class="s2">)</span>
                <span class="s1">link </span><span class="s2">= </span><span class="s1">word</span>

            <span class="s0">elif </span><span class="s1">word </span><span class="s0">in </span><span class="s1">STYLE_ATTRIBUTES</span><span class="s2">:</span>
                <span class="s1">attributes</span><span class="s2">[</span><span class="s1">STYLE_ATTRIBUTES</span><span class="s2">[</span><span class="s1">word</span><span class="s2">]] = </span><span class="s0">True</span>

            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s1">Color</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">word</span><span class="s2">)</span>
                <span class="s0">except </span><span class="s1">ColorParseError </span><span class="s0">as </span><span class="s1">error</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">errors</span><span class="s2">.</span><span class="s1">StyleSyntaxError</span><span class="s2">(</span>
                        <span class="s4">f&quot;unable to parse </span><span class="s0">{</span><span class="s1">word</span><span class="s0">!r} </span><span class="s4">as color; </span><span class="s0">{</span><span class="s1">error</span><span class="s0">}</span><span class="s4">&quot;</span>
                    <span class="s2">) </span><span class="s0">from None</span>
                <span class="s1">color </span><span class="s2">= </span><span class="s1">word</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">Style</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">, </span><span class="s1">bgcolor</span><span class="s2">=</span><span class="s1">bgcolor</span><span class="s2">, </span><span class="s1">link</span><span class="s2">=</span><span class="s1">link</span><span class="s2">, **</span><span class="s1">attributes</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s2">@</span><span class="s1">lru_cache</span><span class="s2">(</span><span class="s1">maxsize</span><span class="s2">=</span><span class="s6">1024</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">get_html_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">theme</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">TerminalTheme</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a CSS style rule.&quot;&quot;&quot;</span>
        <span class="s1">theme </span><span class="s2">= </span><span class="s1">theme </span><span class="s0">or </span><span class="s1">DEFAULT_TERMINAL_THEME</span>
        <span class="s1">css</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
        <span class="s1">append </span><span class="s2">= </span><span class="s1">css</span><span class="s2">.</span><span class="s1">append</span>

        <span class="s1">color </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">color</span>
        <span class="s1">bgcolor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bgcolor</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">reverse</span><span class="s2">:</span>
            <span class="s1">color</span><span class="s2">, </span><span class="s1">bgcolor </span><span class="s2">= </span><span class="s1">bgcolor</span><span class="s2">, </span><span class="s1">color</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dim</span><span class="s2">:</span>
            <span class="s1">foreground_color </span><span class="s2">= (</span>
                <span class="s1">theme</span><span class="s2">.</span><span class="s1">foreground_color </span><span class="s0">if </span><span class="s1">color </span><span class="s0">is None else </span><span class="s1">color</span><span class="s2">.</span><span class="s1">get_truecolor</span><span class="s2">(</span><span class="s1">theme</span><span class="s2">)</span>
            <span class="s2">)</span>
            <span class="s1">color </span><span class="s2">= </span><span class="s1">Color</span><span class="s2">.</span><span class="s1">from_triplet</span><span class="s2">(</span>
                <span class="s1">blend_rgb</span><span class="s2">(</span><span class="s1">foreground_color</span><span class="s2">, </span><span class="s1">theme</span><span class="s2">.</span><span class="s1">background_color</span><span class="s2">, </span><span class="s6">0.5</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">color </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">theme_color </span><span class="s2">= </span><span class="s1">color</span><span class="s2">.</span><span class="s1">get_truecolor</span><span class="s2">(</span><span class="s1">theme</span><span class="s2">)</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">f&quot;color: </span><span class="s0">{</span><span class="s1">theme_color</span><span class="s2">.</span><span class="s1">hex</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">f&quot;text-decoration-color: </span><span class="s0">{</span><span class="s1">theme_color</span><span class="s2">.</span><span class="s1">hex</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">bgcolor </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">theme_color </span><span class="s2">= </span><span class="s1">bgcolor</span><span class="s2">.</span><span class="s1">get_truecolor</span><span class="s2">(</span><span class="s1">theme</span><span class="s2">, </span><span class="s1">foreground</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">f&quot;background-color: </span><span class="s0">{</span><span class="s1">theme_color</span><span class="s2">.</span><span class="s1">hex</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">bold</span><span class="s2">:</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;font-weight: bold&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">italic</span><span class="s2">:</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;font-style: italic&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">underline</span><span class="s2">:</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;text-decoration: underline&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">strike</span><span class="s2">:</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;text-decoration: line-through&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">overline</span><span class="s2">:</span>
            <span class="s1">append</span><span class="s2">(</span><span class="s4">&quot;text-decoration: overline&quot;</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s4">&quot;; &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">css</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">combine</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">styles</span><span class="s2">: </span><span class="s1">Iterable</span><span class="s2">[</span><span class="s4">&quot;Style&quot;</span><span class="s2">]) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Combine styles and get result. 
 
        Args: 
            styles (Iterable[Style]): Styles to combine. 
 
        Returns: 
            Style: A new style instance. 
        &quot;&quot;&quot;</span>
        <span class="s1">iter_styles </span><span class="s2">= </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">styles</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">iter_styles</span><span class="s2">, </span><span class="s1">next</span><span class="s2">(</span><span class="s1">iter_styles</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">chain</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, *</span><span class="s1">styles</span><span class="s2">: </span><span class="s4">&quot;Style&quot;</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Combine styles from positional argument in to a single style. 
 
        Args: 
            *styles (Iterable[Style]): Styles to combine. 
 
        Returns: 
            Style: A new style instance. 
        &quot;&quot;&quot;</span>
        <span class="s1">iter_styles </span><span class="s2">= </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">styles</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">iter_styles</span><span class="s2">, </span><span class="s1">next</span><span class="s2">(</span><span class="s1">iter_styles</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a copy of this style. 
 
        Returns: 
            Style: A new Style instance with identical attributes. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_null</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">NULL_STYLE</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">randint</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">999999</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link </span><span class="s0">else </span><span class="s4">&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_hash</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s2">@</span><span class="s1">lru_cache</span><span class="s2">(</span><span class="s1">maxsize</span><span class="s2">=</span><span class="s6">128</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">clear_meta_and_links</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a copy of this style with link and meta information removed. 
 
        Returns: 
            Style: New style object. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_null</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">NULL_STYLE</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s0">def </span><span class="s1">update_link</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">link</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get a copy with a different value for link. 
 
        Args: 
            link (str, optional): New value for link. Defaults to None. 
 
        Returns: 
            Style: A new Style instance. 
        &quot;&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_style_definition</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s1">link</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">randint</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">999999</span><span class="s2">)</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s1">link </span><span class="s0">else </span><span class="s4">&quot;&quot;</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta</span>
        <span class="s0">return </span><span class="s1">style</span>

    <span class="s0">def </span><span class="s1">render</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s4">&quot;&quot;</span><span class="s2">,</span>
        <span class="s2">*,</span>
        <span class="s1">color_system</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">ColorSystem</span><span class="s2">] = </span><span class="s1">ColorSystem</span><span class="s2">.</span><span class="s1">TRUECOLOR</span><span class="s2">,</span>
        <span class="s1">legacy_windows</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Render the ANSI codes for the style. 
 
        Args: 
            text (str, optional): A string to style. Defaults to &quot;&quot;. 
            color_system (Optional[ColorSystem], optional): Color system to render to. Defaults to ColorSystem.TRUECOLOR. 
 
        Returns: 
            str: A string containing ANSI style codes. 
        &quot;&quot;&quot;</span>
        <span class="s0">if not </span><span class="s1">text </span><span class="s0">or </span><span class="s1">color_system </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">text</span>
        <span class="s1">attrs </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_make_ansi_codes</span><span class="s2">(</span><span class="s1">color_system</span><span class="s2">)</span>
        <span class="s1">rendered </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">\x1b</span><span class="s4">[</span><span class="s0">{</span><span class="s1">attrs</span><span class="s0">}</span><span class="s4">m</span><span class="s0">{</span><span class="s1">text</span><span class="s0">}\x1b</span><span class="s4">[0m&quot; </span><span class="s0">if </span><span class="s1">attrs </span><span class="s0">else </span><span class="s1">text</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link </span><span class="s0">and not </span><span class="s1">legacy_windows</span><span class="s2">:</span>
            <span class="s1">rendered </span><span class="s2">= (</span>
                <span class="s4">f&quot;</span><span class="s0">\x1b</span><span class="s4">]8;id=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link_id</span><span class="s0">}</span><span class="s4">;</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span><span class="s0">}\x1b\\{</span><span class="s1">rendered</span><span class="s0">}\x1b</span><span class="s4">]8;;</span><span class="s0">\x1b\\</span><span class="s4">&quot;</span>
            <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">rendered</span>

    <span class="s0">def </span><span class="s1">test</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Write text with style directly to terminal. 
 
        This method is for testing purposes only. 
 
        Args: 
            text (Optional[str], optional): Text to style or None for style name. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">text </span><span class="s0">or </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>
        <span class="s1">sys</span><span class="s2">.</span><span class="s1">stdout</span><span class="s2">.</span><span class="s1">write</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">render</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span><span class="s0">}\n</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">lru_cache</span><span class="s2">(</span><span class="s1">maxsize</span><span class="s2">=</span><span class="s6">1024</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">_add</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">style</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s4">&quot;Style&quot;</span><span class="s2">]) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">style </span><span class="s0">is None or </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_null</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">self</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_null</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">style</span>
        <span class="s1">new_style</span><span class="s2">: </span><span class="s1">Style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">Style</span><span class="s2">)</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_ansi </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_style_definition </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_color </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_color </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_color</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_bgcolor </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bgcolor</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">= (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">&amp; ~</span><span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes</span><span class="s2">) | (</span>
            <span class="s1">style</span><span class="s2">.</span><span class="s1">_attributes </span><span class="s2">&amp; </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s2">)</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_set_attributes </span><span class="s2">| </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_set_attributes</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_link </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_link </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_link_id </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_link_id</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_null </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_null</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta </span><span class="s0">and </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_meta</span><span class="s2">:</span>
            <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s1">dumps</span><span class="s2">({**</span><span class="s1">self</span><span class="s2">.</span><span class="s1">meta</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">.</span><span class="s1">meta</span><span class="s2">})</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_meta </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_meta </span><span class="s0">or </span><span class="s1">style</span><span class="s2">.</span><span class="s1">_meta</span>
        <span class="s1">new_style</span><span class="s2">.</span><span class="s1">_hash </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_style</span>

    <span class="s0">def </span><span class="s1">__add__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">style</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s4">&quot;Style&quot;</span><span class="s2">]) </span><span class="s1">-&gt; </span><span class="s4">&quot;Style&quot;</span><span class="s2">:</span>
        <span class="s1">combined_style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_add</span><span class="s2">(</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">combined_style</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">() </span><span class="s0">if </span><span class="s1">combined_style</span><span class="s2">.</span><span class="s1">link </span><span class="s0">else </span><span class="s1">combined_style</span>


<span class="s1">NULL_STYLE </span><span class="s2">= </span><span class="s1">Style</span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">StyleStack</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot;A stack of styles.&quot;&quot;&quot;</span>

    <span class="s1">__slots__ </span><span class="s2">= [</span><span class="s4">&quot;_stack&quot;</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">default_style</span><span class="s2">: </span><span class="s4">&quot;Style&quot;</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">Style</span><span class="s2">] = [</span><span class="s1">default_style</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s4">f&quot;&lt;stylestack </span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s0">!r}</span><span class="s4">&gt;&quot;</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">current</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Style</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Get the Style at the top of the stack.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">push</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">style</span><span class="s2">: </span><span class="s1">Style</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Push a new style on to the stack. 
 
        Args: 
            style (Style): New style to combine with current style. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">] + </span><span class="s1">style</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">pop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Style</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Pop last style and discard. 
 
        Returns: 
            Style: New current style (also available as stack.current) 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_stack</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]</span>
</pre>
</body>
</html>